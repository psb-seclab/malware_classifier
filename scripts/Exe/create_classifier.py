# Command line arguments:
#
#    1 - Training feature matrix file path
#    2 - Sample labels file path
#    3 - Classifier file path
from malware_classifier.exe.classification import XGBClassifier
import csv
import os

if (len(os.sys.argv) != 4):
    print('Usage:\tpython create_classifier { Training Feature Matrix File } '\
        + '{ Training Labels File } { Classifier File Path }')
    os.sys.exit(1)
        
feature_matrix_file = os.sys.argv[1]
sample_labels_file = os.sys.argv[2]
classifier_file = os.sys.argv[3]

# Load in the feature matrix and ids.
print('Loading features...')
with open(feature_matrix_file) as file:
    rows = [row for row in csv.reader(file)]
    
    ids = [row[0] for row in rows]
    features = [row[1:] for row in rows]
    
# Load in the labels.
print('Loading labels...')
with open(sample_labels_file) as file:
    rows = [row for row in csv.reader(file)]
    labels_dict = {row[0]: row[1] for row in rows[1:]}
    
labels = [labels_dict[id] for id in ids]

# Create the classifier.
print('Training classifier...')
classifier = XGBClassifier(features, labels, training_ratio=1)

# Save the classifier.
print('Saving classifier...')
classifier.save(classifier_file)

print('\nSuccessfully created classifier file: %s' % classifier_file)